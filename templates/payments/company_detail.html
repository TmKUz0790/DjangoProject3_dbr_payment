{# templates/payments/company_detail.html #}
{#{% extends 'payments/base4.html' %}#}
{##}
{#{% block title %}{{ company.name }} - Details{% endblock %}#}
{##}
{#{% block content %}#}
{#<div class="container mt-4">#}
{#    <!-- Company Header -->#}
{#    <div class="row mb-4">#}
{#        <div class="col-12">#}
{#            <div class="d-flex justify-content-between align-items-center">#}
{#                <h1 class="mb-0">{{ company.name }}</h1>#}
{#                <nav aria-label="breadcrumb">#}
{#                    <ol class="breadcrumb mb-0">#}
{#                        <li class="breadcrumb-item"><a href="{% url 'payments:company-list' %}">Companies</a></li>#}
{#                        <li class="breadcrumb-item active">{{ company.name }}</li>#}
{#                    </ol>#}
{#                </nav>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{##}
{#    <!-- Company Information -->#}
{#    <div class="row mb-4">#}
{#        <div class="col-md-6">#}
{#            <div class="card shadow">#}
{#                <div class="card-header">#}
{#                    <h5 class="mb-0">Company Information</h5>#}
{#                </div>#}
{#                <div class="card-body">#}
{#                    <div class="mb-2">#}
{#                        <strong><i class="fas fa-envelope me-2"></i>Email:</strong>#}
{#                        <span class="ms-2">{{ company.email }}</span>#}
{#                    </div>#}
{#                    <div class="mb-2">#}
{#                        <strong><i class="fas fa-phone me-2"></i>Contact Number:</strong>#}
{#                        <span class="ms-2">{{ company.contact_number }}</span>#}
{#                    </div>#}
{#                    <div class="mb-2">#}
{#                        <strong><i class="fas fa-map-marker-alt me-2"></i>Address:</strong>#}
{#                        <span class="ms-2">{{ company.address }}</span>#}
{#                    </div>#}
{#                    <div class="mb-0">#}
{#                        <strong><i class="fas fa-calendar me-2"></i>Registration Date:</strong>#}
{#                        <span class="ms-2">{{ company.created_at|date:"F j, Y" }}</span>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- Unpaid Months Section -->#}
{#    {% if unpaid_months %}#}
{#    <div class="card shadow mb-4">#}
{#        <div class="card-header bg-danger text-white">#}
{#            <h5 class="mb-0">#}
{#                <i class="fas fa-exclamation-triangle me-2"></i>#}
{#                Unpaid/Partially Paid Months#}
{#            </h5>#}
{#        </div>#}
{#        <div class="card-body">#}
{#            <div class="table-responsive">#}
{#                <table class="table table-hover">#}
{#                    <thead>#}
{#                        <tr>#}
{#                            <th>Arrangement</th>#}
{#                            <th>Month</th>#}
{#                            <th>Due Date</th>#}
{#                            <th>Expected Amount</th>#}
{#                            <th>Paid Amount</th>#}
{#                            <th>Missing Amount</th>#}
{#                            <th>Status</th>#}
{#                        </tr>#}
{#                    </thead>#}
{#                    <tbody>#}
{#                        {% for month in unpaid_months %}#}
{#                            <tr>#}
{#                                <td>Arrangement #{{ month.arrangement_id }}</td>#}
{#                                <td>Month {{ month.month_number }}</td>#}
{#                                <td>{{ month.due_date|date:"M j, Y" }}</td>#}
{#                                <td>${{ month.expected_amount|floatformat:2 }}</td>#}
{#                                <td>${{ month.paid_amount|floatformat:2 }}</td>#}
{#                                <td class="text-danger">${{ month.missing_amount|floatformat:2 }}</td>#}
{#                                <td>#}
{#                                    {% if month.paid_amount == 0 %}#}
{#                                        <span class="badge bg-danger">Unpaid</span>#}
{#                                    {% else %}#}
{#                                        <span class="badge bg-warning text-dark">Partially Paid</span>#}
{#                                    {% endif %}#}
{#                                </td>#}
{#                            </tr>#}
{#                        {% endfor %}#}
{#                    </tbody>#}
{#                </table>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#    {% endif %}#}
{##}
{#    <!-- Payment Arrangements Section -->#}
{#    <div class="card shadow mb-4">#}
{#        <div class="card-header d-flex justify-content-between align-items-center">#}
{#            <h5 class="mb-0">Payment Arrangements</h5>#}
{#            <a href="{% url 'payments:add-arrangement' %}?company={{ company.id }}" class="btn btn-primary">#}
{#                <i class="fas fa-plus me-2"></i>Add New Arrangement#}
{#            </a>#}
{#        </div>#}
{#        <div class="card-body">#}
{#            <div class="row">#}
{#                {% for arrangement in arrangements %}#}
{#                    <div class="col-md-6 col-lg-4 mb-3">#}
{#                        <div class="card h-100 {% if arrangement.is_active %}border-success{% else %}border-secondary{% endif %}">#}
{#                            <div class="card-header {% if arrangement.is_active %}bg-success{% else %}bg-secondary{% endif %} text-white">#}
{#                                <div class="d-flex justify-content-between align-items-center">#}
{#                                    <h6 class="mb-0">Arrangement #{{ arrangement.id }}</h6>#}
{#                                    <button type="button"#}
{#                                            class="btn btn-sm btn-danger"#}
{#                                            data-bs-toggle="modal"#}
{#                                            data-bs-target="#deleteModal{{ arrangement.id }}">#}
{#                                        <i class="fas fa-trash-alt"></i>#}
{#                                    </button>#}
{#                                </div>#}
{#                            </div>#}
{#                            <div class="card-body">#}
{#                                <div class="mb-2">#}
{#                                    <strong>Monthly Amount:</strong>#}
{#                                    <span class="float-end">${{ arrangement.monthly_amount|floatformat:2 }}</span>#}
{#                                </div>#}
{#                                <div class="mb-2">#}
{#                                    <strong>Number of Months:</strong>#}
{#                                    <span class="float-end">{{ arrangement.number_of_months }}</span>#}
{#                                </div>#}
{#                                <div class="mb-2">#}
{#                                    <strong>Total Amount:</strong>#}
{#                                    <span class="float-end">${{ arrangement.total_amount|floatformat:2 }}</span>#}
{#                                </div>#}
{#                                <div class="mb-2">#}
{#                                    <strong>Start Date:</strong>#}
{#                                    <span class="float-end">{{ arrangement.start_date|date:"M j, Y" }}</span>#}
{#                                </div>#}
{#                                <div class="mb-2">#}
{#                                    <strong>End Date:</strong>#}
{#                                    <span class="float-end">{{ arrangement.end_date|date:"M j, Y"|default:"Ongoing" }}</span>#}
{#                                </div>#}
{#                                <div class="mb-0">#}
{#                                    <strong>Status:</strong>#}
{#                                    <span class="float-end">#}
{#                                        <span class="badge {% if arrangement.is_active %}bg-success{% else %}bg-secondary{% endif %}">#}
{#                                            {% if arrangement.is_active %}Active{% else %}Inactive{% endif %}#}
{#                                        </span>#}
{#                                    </span>#}
{#                                </div>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{##}
{#                    <!-- Delete Modal -->#}
{#                    <div class="modal fade" id="deleteModal{{ arrangement.id }}" tabindex="-1">#}
{#                        <div class="modal-dialog">#}
{#                            <div class="modal-content">#}
{#                                <div class="modal-header">#}
{#                                    <h5 class="modal-title">Delete Arrangement</h5>#}
{#                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>#}
{#                                </div>#}
{#                                <div class="modal-body">#}
{#                                    <p>Are you sure you want to delete this payment arrangement?</p>#}
{#                                    <div class="alert alert-info">#}
{#                                        <p class="mb-2"><strong>Arrangement Details:</strong></p>#}
{#                                        <ul class="mb-0">#}
{#                                            <li>Monthly Amount: ${{ arrangement.monthly_amount|floatformat:2 }}</li>#}
{#                                            <li>Number of Months: {{ arrangement.number_of_months }}</li>#}
{#                                            <li>Total Amount: ${{ arrangement.total_amount|floatformat:2 }}</li>#}
{#                                        </ul>#}
{#                                    </div>#}
{#                                    <div class="alert alert-danger mb-0">#}
{#                                        <i class="fas fa-exclamation-triangle me-2"></i>#}
{#                                        This action cannot be undone.#}
{#                                    </div>#}
{#                                </div>#}
{#                                <div class="modal-footer">#}
{#                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>#}
{#                                    <a href="{% url 'payments:delete-arrangement' arrangement.id %}" class="btn btn-danger">#}
{#                                        <i class="fas fa-trash-alt me-2"></i>Delete#}
{#                                    </a>#}
{#                                </div>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{#                {% empty %}#}
{#                    <div class="col-12">#}
{#                        <div class="alert alert-info">#}
{#                            <i class="fas fa-info-circle me-2"></i>#}
{#                            No payment arrangements set up yet.#}
{#                        </div>#}
{#                    </div>#}
{#                {% endfor %}#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- Payment History Section - Updated with delete functionality -->#}
{#    <div class="card shadow">#}
{#        <div class="card-header d-flex justify-content-between align-items-center">#}
{#            <h5 class="mb-0">Payment History</h5>#}
{#            <a href="{% url 'payments:add-payment' %}?company={{ company.id }}" class="btn btn-success">#}
{#                <i class="fas fa-plus me-2"></i>Record New Payment#}
{#            </a>#}
{#        </div>#}
{#        <div class="card-body">#}
{#            <div class="table-responsive">#}
{#                <table class="table table-hover">#}
{#                    <thead>#}
{#                        <tr>#}
{#                            <th>Date</th>#}
{#                            <th>Arrangement</th>#}
{#                            <th>Month</th>#}
{#                            <th>Amount</th>#}
{#                            <th>Method</th>#}
{#                            <th>Status</th>#}
{#                            <th>Notes</th>#}
{#                            <th>Actions</th>#}
{#                        </tr>#}
{#                    </thead>#}
{#                    <tbody>#}
{#                        {% for payment in payments %}#}
{#                            <tr>#}
{#                                <td>{{ payment.payment_date|date:"M j, Y" }}</td>#}
{#                                <td>Arrangement #{{ payment.arrangement.id }}</td>#}
{#                                <td>Month {{ payment.month_number }}</td>#}
{#                                <td>${{ payment.amount_paid|floatformat:2 }}</td>#}
{#                                <td>{{ payment.payment_method }}</td>#}
{#                                <td>#}
{#                                    <span class="badge {% if payment.status == 'COMPLETED' %}bg-success#}
{#                                                      {% elif payment.status == 'PENDING' %}bg-warning text-dark#}
{#                                                      {% elif payment.status == 'PARTIAL' %}bg-warning text-dark#}
{#                                                      {% elif payment.status == 'UNPAID' %}bg-danger#}
{#                                                      {% else %}bg-danger{% endif %}">#}
{#                                        {{ payment.get_status_display }}#}
{#                                    </span>#}
{#                                </td>#}
{#                                <td>{{ payment.notes|truncatechars:30|default:"-" }}</td>#}
{#                                <td>#}
{#                                    <button type="button" #}
{#                                            class="btn btn-sm btn-danger" #}
{#                                            data-bs-toggle="modal" #}
{#                                            data-bs-target="#deletePaymentModal{{ payment.id }}">#}
{#                                        <i class="fas fa-trash-alt"></i>#}
{#                                    </button>#}
{#                                </td>#}
{#                            </tr>#}
{##}
{#                            <!-- Delete Payment Modal -->#}
{#                            <div class="modal fade" id="deletePaymentModal{{ payment.id }}" tabindex="-1">#}
{#                                <div class="modal-dialog">#}
{#                                    <div class="modal-content">#}
{#                                        <div class="modal-header">#}
{#                                            <h5 class="modal-title">Delete Payment</h5>#}
{#                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>#}
{#                                        </div>#}
{#                                        <div class="modal-body">#}
{#                                            <p>Are you sure you want to delete this payment?</p>#}
{#                                            <div class="alert alert-info">#}
{#                                                <p class="mb-2"><strong>Payment Details:</strong></p>#}
{#                                                <ul class="mb-0">#}
{#                                                    <li>Date: {{ payment.payment_date|date:"M j, Y" }}</li>#}
{#                                                    <li>Amount: ${{ payment.amount_paid|floatformat:2 }}</li>#}
{#                                                    <li>Arrangement: #{{ payment.arrangement.id }}</li>#}
{#                                                    <li>Month: {{ payment.month_number }}</li>#}
{#                                                    {% if payment.notes %}#}
{#                                                        <li>Notes: {{ payment.notes }}</li>#}
{#                                                    {% endif %}#}
{#                                                </ul>#}
{#                                            </div>#}
{#                                            <div class="alert alert-danger mb-0">#}
{#                                                <i class="fas fa-exclamation-triangle me-2"></i>#}
{#                                                This action cannot be undone.#}
{#                                            </div>#}
{#                                        </div>#}
{#                                        <div class="modal-footer">#}
{#                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>#}
{#                                            <form method="POST" action="{% url 'payments:delete-payment' payment.id %}" class="d-inline">#}
{#                                                {% csrf_token %}#}
{#                                                <button type="submit" class="btn btn-danger">#}
{#                                                    <i class="fas fa-trash-alt me-2"></i>Delete#}
{#                                                </button>#}
{#                                            </form>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                </div>#}
{#                            </div>#}
{#                        {% empty %}#}
{#                            <tr>#}
{#                                <td colspan="8" class="text-center">No payments recorded yet.</td>#}
{#                            </tr>#}
{#                        {% endfor %}#}
{#                    </tbody>#}
{#                </table>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#</div>#}

{#{% endblock %}#}

{# templates/payments/company_detail.html #}

{##}
{#{% extends 'payments/base4.html' %}#}
{##}
{#{% block title %}{{ company.name }} - Tafsilotlar{% endblock %}#}
{##}
{#{% block extra_css %}#}
{#<style>#}
{#    :root {#}
{#        --primary: #222831;#}
{#        --secondary: #393E46;#}
{#        --accent: #FFD369;#}
{#        --light: #EEEEEE;#}
{#        --success: #00ADB5;#}
{#        --danger: #FF5722;#}
{#        --warning: #FFA000;#}
{#    }#}
{#    #}
{#    body {#}
{#        background-color: var(--light);#}
{#        background-image: #}
{#            radial-gradient(circle at 90% 10%, rgba(255, 211, 105, 0.1) 0%, transparent 20%),#}
{#            radial-gradient(circle at 10% 90%, rgba(0, 173, 181, 0.1) 0%, transparent 20%);#}
{#        background-attachment: fixed;#}
{#    }#}
{#    #}
{#    /* ===== HEADER DESIGN ===== */#}
{#    .page-header {#}
{#        background-color: var(--primary);#}
{#        padding: 2rem 2.5rem;#}
{#        border-radius: 0.5rem;#}
{#        position: relative;#}
{#        overflow: hidden;#}
{#        margin-bottom: 2rem;#}
{#        box-shadow: 0 6px 30px rgba(0, 0, 0, 0.1);#}
{#        z-index: 10;#}
{#    }#}
{#    #}
{#    .page-header::before {#}
{#        content: '';#}
{#        position: absolute;#}
{#        top: 0;#}
{#        right: 0;#}
{#        width: 150px;#}
{#        height: 150px;#}
{#        background-color: var(--accent);#}
{#        clip-path: polygon(100% 0, 0 0, 100% 100%);#}
{#        opacity: 0.2;#}
{#        z-index: -1;#}
{#    }#}
{#    #}
{#    .page-header::after {#}
{#        content: '';#}
{#        position: absolute;#}
{#        bottom: 0;#}
{#        left: 0;#}
{#        width: 120px;#}
{#        height: 120px;#}
{#        background-color: var(--success);#}
{#        clip-path: polygon(0 100%, 0 0, 100% 100%);#}
{#        opacity: 0.2;#}
{#        z-index: -1;#}
{#    }#}
{#    #}
{#    .header-content {#}
{#        display: flex;#}
{#        justify-content: space-between;#}
{#        align-items: center;#}
{#        flex-wrap: wrap;#}
{#        gap: 1rem;#}
{#    }#}
{#    #}
{#    .company-title {#}
{#        color: var(--light);#}
{#        margin: 0;#}
{#        font-size: 2rem;#}
{#        font-weight: 700;#}
{#        position: relative;#}
{#    }#}
{#    #}
{#    .company-title::after {#}
{#        content: '';#}
{#        position: absolute;#}
{#        bottom: -8px;#}
{#        left: 0;#}
{#        width: 50px;#}
{#        height: 3px;#}
{#        background-color: var(--accent);#}
{#    }#}
{#    #}
{#    .breadcrumb {#}
{#        display: flex;#}
{#        list-style: none;#}
{#        margin: 0;#}
{#        padding: 0;#}
{#        background: transparent;#}
{#    }#}
{#    #}
{#    .breadcrumb-item {#}
{#        color: rgba(255, 255, 255, 0.7);#}
{#        font-weight: 500;#}
{#    }#}
{#    #}
{#    .breadcrumb-item + .breadcrumb-item::before {#}
{#        content: "/";#}
{#        color: rgba(255, 255, 255, 0.5);#}
{#        padding: 0 0.5rem;#}
{#    }#}
{#    #}
{#    .breadcrumb-item a {#}
{#        color: var(--accent);#}
{#        text-decoration: none;#}
{#        transition: color 0.2s ease;#}
{#    }#}
{#    #}
{#    .breadcrumb-item a:hover {#}
{#        color: white;#}
{#    }#}
{#    #}
{#    .breadcrumb-item.active {#}
{#        color: white;#}
{#    }#}
{#    #}
{#    /* ===== CARD STYLES ===== */#}
{#    .custom-card {#}
{#        background-color: white;#}
{#        border-radius: 0.5rem;#}
{#        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);#}
{#        margin-bottom: 2rem;#}
{#        overflow: hidden;#}
{#    }#}
{#    #}
{#    .card-header {#}
{#        padding: 1.25rem 1.5rem;#}
{#        background-color: #f8f9fa;#}
{#        border-bottom: 1px solid rgba(0, 0, 0, 0.05);#}
{#        display: flex;#}
{#        justify-content: space-between;#}
{#        align-items: center;#}
{#    }#}
{#    #}
{#    .card-header h5 {#}
{#        margin: 0;#}
{#        font-size: 1.25rem;#}
{#        font-weight: 600;#}
{#        color: var(--primary);#}
{#    }#}
{#    #}
{#    .card-body {#}
{#        padding: 1.5rem;#}
{#    }#}
{#    #}
{#    /* Special headers */#}
{#    .header-danger {#}
{#        background-color: var(--danger);#}
{#        color: white;#}
{#    }#}
{#    #}
{#    .header-success {#}
{#        background-color: var(--success);#}
{#        color: white;#}
{#    }#}
{#    #}
{#    .header-accent {#}
{#        background-color: var(--accent);#}
{#        color: var(--primary);#}
{#    }#}
{#    #}
{#    /* ===== COMPANY INFO CARD ===== */#}
{#    .info-item {#}
{#        display: flex;#}
{#        margin-bottom: 1rem;#}
{#        align-items: center;#}
{#    }#}
{#    #}
{#    .info-item:last-child {#}
{#        margin-bottom: 0;#}
{#    }#}
{#    #}
{#    .info-icon {#}
{#        width: 36px;#}
{#        height: 36px;#}
{#        background-color: #f8f9fa;#}
{#        border-radius: 50%;#}
{#        display: flex;#}
{#        align-items: center;#}
{#        justify-content: center;#}
{#        color: var(--primary);#}
{#        margin-right: 1rem;#}
{#    }#}
{#    #}
{#    .info-label {#}
{#        font-weight: 600;#}
{#        color: var(--secondary);#}
{#        margin-right: 0.5rem;#}
{#    }#}
{#    #}
{#    .info-value {#}
{#        color: var(--primary);#}
{#    }#}
{#    #}
{#    /* ===== TABLES ===== */#}
{#    .custom-table {#}
{#        width: 100%;#}
{#        border-collapse: separate;#}
{#        border-spacing: 0;#}
{#    }#}
{#    #}
{#    .custom-table th {#}
{#        background-color: #f8f9fa;#}
{#        padding: 0.75rem 1rem;#}
{#        font-weight: 600;#}
{#        color: var(--secondary);#}
{#        border-bottom: 2px solid #e9ecef;#}
{#        text-align: left;#}
{#    }#}
{#    #}
{#    .custom-table td {#}
{#        padding: 1rem;#}
{#        border-bottom: 1px solid #e9ecef;#}
{#        vertical-align: middle;#}
{#    }#}
{#    #}
{#    .custom-table tr:last-child td {#}
{#        border-bottom: none;#}
{#    }#}
{#    #}
{#    .custom-table tr:hover {#}
{#        background-color: #f8f9fa;#}
{#    }#}
{#    #}
{#    .table-responsive {#}
{#        overflow-x: auto;#}
{#        -webkit-overflow-scrolling: touch;#}
{#    }#}
{#    #}
{#    /* ===== BADGES ===== */#}
{#    .badge {#}
{#        display: inline-block;#}
{#        padding: 0.35em 0.65em;#}
{#        font-size: 0.75em;#}
{#        font-weight: 600;#}
{#        line-height: 1;#}
{#        text-align: center;#}
{#        white-space: nowrap;#}
{#        vertical-align: baseline;#}
{#        border-radius: 50rem;#}
{#    }#}
{#    #}
{#    .badge-success {#}
{#        background-color: var(--success);#}
{#        color: white;#}
{#    }#}
{#    #}
{#    .badge-danger {#}
{#        background-color: var(--danger);#}
{#        color: white;#}
{#    }#}
{#    #}
{#    .badge-warning {#}
{#        background-color: var(--warning);#}
{#        color: white;#}
{#    }#}
{#    #}
{#    .badge-secondary {#}
{#        background-color: var(--secondary);#}
{#        color: white;#}
{#    }#}
{#    #}
{#    /* ===== ARRANGEMENT CARDS ===== */#}
{#    .arrangements-grid {#}
{#        display: grid;#}
{#        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));#}
{#        gap: 1.5rem;#}
{#    }#}
{#    #}
{#    .arrangement-card {#}
{#        background-color: white;#}
{#        border-radius: 0.5rem;#}
{#        overflow: hidden;#}
{#        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);#}
{#        height: 100%;#}
{#        border: 2px solid transparent;#}
{#        transition: transform 0.2s ease, box-shadow 0.2s ease;#}
{#    }#}
{#    #}
{#    .arrangement-card:hover {#}
{#        transform: translateY(-5px);#}
{#        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);#}
{#    }#}
{#    #}
{#    .arrangement-card.active {#}
{#        border-color: var(--success);#}
{#    }#}
{#    #}
{#    .arrangement-card.inactive {#}
{#        border-color: var(--secondary);#}
{#    }#}
{#    #}
{#    .arrangement-header {#}
{#        padding: 1rem 1.25rem;#}
{#        display: flex;#}
{#        justify-content: space-between;#}
{#        align-items: center;#}
{#    }#}
{#    #}
{#    .arrangement-header.active {#}
{#        background-color: var(--success);#}
{#        color: white;#}
{#    }#}
{#    #}
{#    .arrangement-header.inactive {#}
{#        background-color: var(--secondary);#}
{#        color: white;#}
{#    }#}
{#    #}
{#    .arrangement-header h6 {#}
{#        margin: 0;#}
{#        font-weight: 600;#}
{#    }#}
{#    #}
{#    .arrangement-body {#}
{#        padding: 1.25rem;#}
{#    }#}
{#    #}
{#    .arrangement-item {#}
{#        display: flex;#}
{#        justify-content: space-between;#}
{#        margin-bottom: 0.75rem;#}
{#    }#}
{#    #}
{#    .arrangement-item:last-child {#}
{#        margin-bottom: 0;#}
{#    }#}
{#    #}
{#    .arrangement-label {#}
{#        font-weight: 600;#}
{#        color: var(--secondary);#}
{#    }#}
{#    #}
{#    .arrangement-value {#}
{#        color: var(--primary);#}
{#    }#}
{#    #}
{#    /* ===== BUTTONS ===== */#}
{#    .btn {#}
{#        display: inline-flex;#}
{#        align-items: center;#}
{#        justify-content: center;#}
{#        font-weight: 600;#}
{#        text-align: center;#}
{#        text-decoration: none;#}
{#        vertical-align: middle;#}
{#        cursor: pointer;#}
{#        user-select: none;#}
{#        padding: 0.5rem 1rem;#}
{#        font-size: 1rem;#}
{#        border-radius: 0.5rem;#}
{#        border: none;#}
{#        transition: all 0.15s ease-in-out;#}
{#        gap: 0.5rem;#}
{#    }#}
{#    #}
{#    .btn-sm {#}
{#        padding: 0.25rem 0.5rem;#}
{#        font-size: 0.875rem;#}
{#    }#}
{#    #}
{#    .btn-primary {#}
{#        color: var(--primary);#}
{#        background-color: var(--accent);#}
{#    }#}
{#    #}
{#    .btn-primary:hover {#}
{#        background-color: #ffc840;#}
{#        box-shadow: 0 4px 10px rgba(255, 211, 105, 0.3);#}
{#    }#}
{#    #}
{#    .btn-success {#}
{#        color: white;#}
{#        background-color: var(--success);#}
{#    }#}
{#    #}
{#    .btn-success:hover {#}
{#        background-color: #00c2cc;#}
{#        box-shadow: 0 4px 10px rgba(0, 173, 181, 0.3);#}
{#    }#}
{#    #}
{#    .btn-secondary {#}
{#        color: white;#}
{#        background-color: var(--secondary);#}
{#    }#}
{#    #}
{#    .btn-secondary:hover {#}
{#        background-color: #424852;#}
{#        box-shadow: 0 4px 10px rgba(57, 62, 70, 0.3);#}
{#    }#}
{#    #}
{#    .btn-danger {#}
{#        color: white;#}
{#        background-color: var(--danger);#}
{#    }#}
{#    #}
{#    .btn-danger:hover {#}
{#        background-color: #ff7043;#}
{#        box-shadow: 0 4px 10px rgba(255, 87, 34, 0.3);#}
{#    }#}
{#    #}
{#    /* ===== MODAL ===== */#}
{#    .modal {#}
{#        position: fixed;#}
{#        top: 0;#}
{#        left: 0;#}
{#        z-index: 1050;#}
{#        width: 100%;#}
{#        height: 100%;#}
{#        overflow: hidden;#}
{#        outline: 0;#}
{#        background-color: rgba(0, 0, 0, 0.5);#}
{#        display: none;#}
{#    }#}
{#    #}
{#    .modal.show {#}
{#        display: block;#}
{#    }#}
{#    #}
{#    .modal-dialog {#}
{#        position: relative;#}
{#        width: auto;#}
{#        margin: 1.75rem auto;#}
{#        max-width: 500px;#}
{#        pointer-events: none;#}
{#    }#}
{#    #}
{#    .modal-content {#}
{#        position: relative;#}
{#        display: flex;#}
{#        flex-direction: column;#}
{#        width: 100%;#}
{#        pointer-events: auto;#}
{#        background-color: white;#}
{#        border-radius: 0.5rem;#}
{#        outline: 0;#}
{#        overflow: hidden;#}
{#        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);#}
{#    }#}
{#    #}
{#    .modal-header {#}
{#        display: flex;#}
{#        align-items: center;#}
{#        justify-content: space-between;#}
{#        padding: 1rem 1.5rem;#}
{#        border-bottom: 1px solid #e9ecef;#}
{#    }#}
{#    #}
{#    .modal-title {#}
{#        margin: 0;#}
{#        font-size: 1.25rem;#}
{#        font-weight: 600;#}
{#    }#}
{#    #}
{#    .btn-close {#}
{#        background: transparent;#}
{#        border: none;#}
{#        font-size: 1.5rem;#}
{#        line-height: 1;#}
{#        color: #000;#}
{#        opacity: 0.5;#}
{#        padding: 0;#}
{#        cursor: pointer;#}
{#    }#}
{#    #}
{#    .modal-body {#}
{#        padding: 1.5rem;#}
{#    }#}
{#    #}
{#    .modal-footer {#}
{#        display: flex;#}
{#        justify-content: flex-end;#}
{#        align-items: center;#}
{#        padding: 1rem 1.5rem;#}
{#        border-top: 1px solid #e9ecef;#}
{#        gap: 0.5rem;#}
{#    }#}
{#    #}
{#    /* ===== ALERTS ===== */#}
{#    .alert {#}
{#        position: relative;#}
{#        padding: 1rem 1.25rem;#}
{#        margin-bottom: 1rem;#}
{#        border: 1px solid transparent;#}
{#        border-radius: 0.5rem;#}
{#    }#}
{#    #}
{#    .alert:last-child {#}
{#        margin-bottom: 0;#}
{#    }#}
{#    #}
{#    .alert-info {#}
{#        color: #0c5460;#}
{#        background-color: #d1ecf1;#}
{#        border-color: #bee5eb;#}
{#    }#}
{#    #}
{#    .alert-danger {#}
{#        color: #721c24;#}
{#        background-color: #f8d7da;#}
{#        border-color: #f5c6cb;#}
{#    }#}
{#    #}
{#    .alert-warning {#}
{#        color: #856404;#}
{#        background-color: #fff3cd;#}
{#        border-color: #ffeeba;#}
{#    }#}
{#    #}
{#    /* ===== RESPONSIVE STYLES ===== */#}
{#    @media (max-width: 767.98px) {#}
{#        .page-header {#}
{#            padding: 1.5rem;#}
{#        }#}
{#        #}
{#        .header-content {#}
{#            flex-direction: column;#}
{#            align-items: flex-start;#}
{#        }#}
{#        #}
{#        .breadcrumb {#}
{#            margin-top: 1rem;#}
{#        }#}
{#        #}
{#        .card-header {#}
{#            flex-direction: column;#}
{#            align-items: flex-start;#}
{#            gap: 1rem;#}
{#        }#}
{#        #}
{#        .arrangements-grid {#}
{#            grid-template-columns: 1fr;#}
{#        }#}
{#    }#}
{#</style>#}
{#{% endblock %}#}
{##}
{#{% block content %}#}
{#<div class="container mt-4">#}
{#    <!-- Company Header -->#}
{#    <div class="page-header">#}
{#        <div class="header-content">#}
{#            <h1 class="company-title">{{ company.name }}</h1>#}
{#            <nav aria-label="breadcrumb">#}
{#                <ol class="breadcrumb">#}
{#                    <li class="breadcrumb-item"><a href="{% url 'payments:company-list' %}">Kompaniyalar</a></li>#}
{#                    <li class="breadcrumb-item active">{{ company.name }}</li>#}
{#                </ol>#}
{#            </nav>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- Company Information -->#}
{#    <div class="custom-card">#}
{#        <div class="card-header">#}
{#            <h5>Kompaniya Ma'lumotlari</h5>#}
{#        </div>#}
{#        <div class="card-body">#}
{#            <div class="info-item">#}
{#                <div class="info-icon">#}
{#                    <i class="fas fa-envelope"></i>#}
{#                </div>#}
{#                <span class="info-label">Email:</span>#}
{#                <span class="info-value">{{ company.email }}</span>#}
{#            </div>#}
{#            <div class="info-item">#}
{#                <div class="info-icon">#}
{#                    <i class="fas fa-phone"></i>#}
{#                </div>#}
{#                <span class="info-label">Telefon Raqami:</span>#}
{#                <span class="info-value">{{ company.contact_number }}</span>#}
{#            </div>#}
{#            <div class="info-item">#}
{#                <div class="info-icon">#}
{#                    <i class="fas fa-map-marker-alt"></i>#}
{#                </div>#}
{#                <span class="info-label">Manzil:</span>#}
{#                <span class="info-value">{{ company.address }}</span>#}
{#            </div>#}
{#            <div class="info-item">#}
{#                <div class="info-icon">#}
{#                    <i class="fas fa-calendar"></i>#}
{#                </div>#}
{#                <span class="info-label">Ro'yxatga Olingan Sana:</span>#}
{#                <span class="info-value">{{ company.created_at|date:"F j, Y" }}</span>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- Unpaid Months Section -->#}
{#    {% if unpaid_months %}#}
{#    <div class="custom-card">#}
{#        <div class="card-header header-danger">#}
{#            <h5>#}
{#                <i class="fas fa-exclamation-triangle me-2"></i>#}
{#                To'lanmagan/Qisman to'langan oylar#}
{#            </h5>#}
{#        </div>#}
{#        <div class="card-body">#}
{#            <div class="table-responsive">#}
{#                <table class="custom-table">#}
{#                    <thead>#}
{#                        <tr>#}
{#                            <th>Shartnoma</th>#}
{#                            <th>Oy</th>#}
{#                            <th>To'lov Muddati</th>#}
{#                            <th>Kutilgan Summa</th>#}
{#                            <th>To'langan Summa</th>#}
{#                            <th>Yetishmayotgan Summa</th>#}
{#                            <th>Holat</th>#}
{#                        </tr>#}
{#                    </thead>#}
{#                    <tbody>#}
{#                        {% for month in unpaid_months %}#}
{#                            <tr>#}
{#                                <td>Shartnoma #{{ month.arrangement_id }}</td>#}
{#                                <td>{{ month.month_number }}-oy</td>#}
{#                                <td>{{ month.due_date|date:"M j, Y" }}</td>#}
{#                                <td>${{ month.expected_amount|floatformat:2 }}</td>#}
{#                                <td>${{ month.paid_amount|floatformat:2 }}</td>#}
{#                                <td class="text-danger">${{ month.missing_amount|floatformat:2 }}</td>#}
{#                                <td>#}
{#                                    {% if month.paid_amount == 0 %}#}
{#                                        <span class="badge badge-danger">To'lanmagan</span>#}
{#                                    {% else %}#}
{#                                        <span class="badge badge-warning">Qisman to'langan</span>#}
{#                                    {% endif %}#}
{#                                </td>#}
{#                            </tr>#}
{#                        {% endfor %}#}
{#                    </tbody>#}
{#                </table>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#    {% endif %}#}
{##}
{#    <!-- Payment Arrangements Section -->#}
{#    <div class="custom-card">#}
{#        <div class="card-header">#}
{#            <h5>To'lov Shartnomalari</h5>#}
{#            <a href="{% url 'payments:add-arrangement' %}?company={{ company.id }}" class="btn btn-primary">#}
{#                <i class="fas fa-plus"></i> Yangi Shartnoma Qo'shish#}
{#            </a>#}
{#        </div>#}
{#        <div class="card-body">#}
{#            <div class="arrangements-grid">#}
{#                {% for arrangement in arrangements %}#}
{#                    <div class="arrangement-card {% if arrangement.is_active %}active{% else %}inactive{% endif %}">#}
{#                        <div class="arrangement-header {% if arrangement.is_active %}active{% else %}inactive{% endif %}">#}
{#                            <h6>Shartnoma #{{ arrangement.id }}</h6>#}
{#                            <button type="button"#}
{#                                    class="btn btn-sm btn-danger"#}
{#                                    data-bs-toggle="modal"#}
{#                                    data-bs-target="#deleteModal{{ arrangement.id }}">#}
{#                                <i class="fas fa-trash-alt"></i>#}
{#                            </button>#}
{#                        </div>#}
{#                        <div class="arrangement-body">#}
{#                            <div class="arrangement-item">#}
{#                                <span class="arrangement-label">Oylik To'lov:</span>#}
{#                                <span class="arrangement-value">${{ arrangement.monthly_amount|floatformat:2 }}</span>#}
{#                            </div>#}
{#                            <div class="arrangement-item">#}
{#                                <span class="arrangement-label">Oylar Soni:</span>#}
{#                                <span class="arrangement-value">{{ arrangement.number_of_months }}</span>#}
{#                            </div>#}
{#                            <div class="arrangement-item">#}
{#                                <span class="arrangement-label">Jami Summa:</span>#}
{#                                <span class="arrangement-value">${{ arrangement.total_amount|floatformat:2 }}</span>#}
{#                            </div>#}
{#                            <div class="arrangement-item">#}
{#                                <span class="arrangement-label">Boshlanish Sanasi:</span>#}
{#                                <span class="arrangement-value">{{ arrangement.start_date|date:"M j, Y" }}</span>#}
{#                            </div>#}
{#                            <div class="arrangement-item">#}
{#                                <span class="arrangement-label">Tugash Sanasi:</span>#}
{#                                <span class="arrangement-value">{{ arrangement.end_date|date:"M j, Y"|default:"Davom etmoqda" }}</span>#}
{#                            </div>#}
{#                            <div class="arrangement-item">#}
{#                                <span class="arrangement-label">Holat:</span>#}
{#                                <span class="arrangement-value">#}
{#                                    <span class="badge {% if arrangement.is_active %}badge-success{% else %}badge-secondary{% endif %}">#}
{#                                        {% if arrangement.is_active %}Faol{% else %}Faol emas{% endif %}#}
{#                                    </span>#}
{#                                </span>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{##}
{#                    <!-- Delete Modal -->#}
{#                    <div class="modal fade" id="deleteModal{{ arrangement.id }}" tabindex="-1">#}
{#                        <div class="modal-dialog">#}
{#                            <div class="modal-content">#}
{#                                <div class="modal-header">#}
{#                                    <h5 class="modal-title">Shartnomani O'chirish</h5>#}
{#                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>#}
{#                                </div>#}
{#                                <div class="modal-body">#}
{#                                    <p>Haqiqatan ham ushbu to'lov shartnomasini o'chirishni xohlaysizmi?</p>#}
{#                                    <div class="alert alert-info">#}
{#                                        <p class="mb-2"><strong>Shartnoma tafsilotlari:</strong></p>#}
{#                                        <ul class="mb-0">#}
{#                                            <li>Oylik To'lov: ${{ arrangement.monthly_amount|floatformat:2 }}</li>#}
{#                                            <li>Oylar Soni: {{ arrangement.number_of_months }}</li>#}
{#                                            <li>Jami Summa: ${{ arrangement.total_amount|floatformat:2 }}</li>#}
{#                                        </ul>#}
{#                                    </div>#}
{#                                    <div class="alert alert-danger mb-0">#}
{#                                        <i class="fas fa-exclamation-triangle me-2"></i>#}
{#                                        Bu amalni ortga qaytarib bo'lmaydi.#}
{#                                    </div>#}
{#                                </div>#}
{#                                <div class="modal-footer">#}
{#                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bekor qilish</button>#}
{#                                    <a href="{% url 'payments:delete-arrangement' arrangement.id %}" class="btn btn-danger">#}
{#                                        <i class="fas fa-trash-alt"></i> O'chirish#}
{#                                    </a>#}
{#                                </div>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{#                {% empty %}#}
{#                    <div class="col-12">#}
{#                        <div class="alert alert-info">#}
{#                            <i class="fas fa-info-circle me-2"></i>#}
{#                            Hali hech qanday to'lov shartnomasi yo'q.#}
{#                        </div>#}
{#                    </div>#}
{#                {% endfor %}#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- Payment History Section -->#}
{#    <div class="custom-card">#}
{#        <div class="card-header">#}
{#            <h5>To'lovlar Tarixi</h5>#}
{#            <a href="{% url 'payments:add-payment' %}?company={{ company.id }}" class="btn btn-success">#}
{#                <i class="fas fa-plus"></i> Yangi To'lovni Qayd Etish#}
{#            </a>#}
{#        </div>#}
{#        <div class="card-body">#}
{#            <div class="table-responsive">#}
{#                <table class="custom-table">#}
{#                    <thead>#}
{#                        <tr>#}
{#                            <th>Sana</th>#}
{#                            <th>Shartnoma</th>#}
{#                            <th>Oy</th>#}
{#                            <th>Summa</th>#}
{#                            <th>To'lov Usuli</th>#}
{#                            <th>Holat</th>#}
{#                            <th>Izohlar</th>#}
{#                            <th>Harakatlar</th>#}
{#                        </tr>#}
{#                    </thead>#}
{#                    <tbody>#}
{#                        {% for payment in payments %}#}
{#                            <tr>#}
{#                                <td>{{ payment.payment_date|date:"M j, Y" }}</td>#}
{#                                <td>Shartnoma #{{ payment.arrangement.id }}</td>#}
{#                                <td>{{ payment.month_number }}-oy</td>#}
{#                                <td>${{ payment.amount_paid|floatformat:2 }}</td>#}
{#                                <td>{{ payment.payment_method }}</td>#}
{#                                <td>#}
{#                                    <span class="badge {% if payment.status == 'COMPLETED' %}badge-success#}
{#                                                      {% elif payment.status == 'PENDING' %}badge-warning#}
{#                                                      {% elif payment.status == 'PARTIAL' %}badge-warning#}
{#                                                      {% elif payment.status == 'UNPAID' %}badge-danger#}
{#                                                      {% else %}badge-danger{% endif %}">#}
{#                                        {% if payment.status == 'COMPLETED' %}To'langan#}
{#                                        {% elif payment.status == 'PENDING' %}Kutilmoqda#}
{#                                        {% elif payment.status == 'PARTIAL' %}Qisman to'langan#}
{#                                        {% elif payment.status == 'UNPAID' %}To'lanmagan#}
{#                                        {% else %}{{ payment.get_status_display }}{% endif %}#}
{#                                    </span>#}
{#                                </td>#}
{#                                <td>{{ payment.notes|truncatechars:30|default:"-" }}</td>#}
{#                                <td>#}
{#                                    <button type="button" #}
{#                                            class="btn btn-sm btn-danger" #}
{#                                            data-bs-toggle="modal" #}
{#                                            data-bs-target="#deletePaymentModal{{ payment.id }}">#}
{#                                        <i class="fas fa-trash-alt"></i>#}
{#                                    </button>#}
{#                                </td>#}
{#                            </tr>#}
{##}
{#                            <!-- Delete Payment Modal -->#}
{#                            <div class="modal fade" id="deletePaymentModal{{ payment.id }}" tabindex="-1">#}
{#                                <div class="modal-dialog">#}
{#                                    <div class="modal-content">#}
{#                                        <div class="modal-header">#}
{#                                            <h5 class="modal-title">To'lovni O'chirish</h5>#}
{#                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>#}
{#                                        </div>#}
{#                                        <div class="modal-body">#}
{#                                            <p>Haqiqatan ham ushbu to'lovni o'chirishni xohlaysizmi?</p>#}
{#                                            <div class="alert alert-info">#}
{#                                                <p class="mb-2"><strong>To'lov tafsilotlari:</strong></p>#}
{#                                                <ul class="mb-0">#}
{#                                                    <li>Sana: {{ payment.payment_date|date:"M j, Y" }}</li>#}
{#                                                    <li>Summa: ${{ payment.amount_paid|floatformat:2 }}</li>#}
{#                                                    <li>Shartnoma: #{{ payment.arrangement.id }}</li>#}
{#                                                    <li>Oy: {{ payment.month_number }}</li>#}
{#                                                    {% if payment.notes %}#}
{#                                                        <li>Izohlar: {{ payment.notes }}</li>#}
{#                                                    {% endif %}#}
{#                                                </ul>#}
{#                                            </div>#}
{#                                            <div class="alert alert-danger mb-0">#}
{#                                                <i class="fas fa-exclamation-triangle me-2"></i>#}
{#                                                Bu amalni ortga qaytarib bo'lmaydi.#}
{#                                            </div>#}
{#                                        </div>#}
{#                                        <div class="modal-footer">#}
{#                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bekor qilish</button>#}
{#                                            <form method="POST" action="{% url 'payments:delete-payment' payment.id %}" class="d-inline">#}
{#                                                {% csrf_token %}#}
{#                                                <button type="submit" class="btn btn-danger">#}
{#                                                    <i class="fas fa-trash-alt"></i> O'chirish#}
{#                                                </button>#}
{#                                            </form>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                </div>#}
{#                            </div>#}
{#                        {% empty %}#}
{#                            <tr>#}
{#                                <td colspan="8" class="text-center">Hali hech qanday to'lov qayd etilmagan.</td>#}
{#                            </tr>#}
{#                        {% endfor %}#}
{#                    </tbody>#}
{#                </table>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#</div>#}
{#{% endblock %}#}


{% extends 'payments/base4.html' %}

{% block title %}{{ company.name }} - Tafsilotlar{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary: #222831;
        --secondary: #393E46;
        --accent: #FFD369;
        --light: #EEEEEE;
        --success: #00ADB5;
        --danger: #FF5722;
        --warning: #FFA000;
    }
    
    body {
        background-color: var(--light);
        background-image: 
            radial-gradient(circle at 90% 10%, rgba(255, 211, 105, 0.1) 0%, transparent 20%),
            radial-gradient(circle at 10% 90%, rgba(0, 173, 181, 0.1) 0%, transparent 20%);
        background-attachment: fixed;
    }
    
    /* ===== HEADER DESIGN ===== */
    .page-header {
        background-color: var(--primary);
        padding: 2rem 2.5rem;
        border-radius: 0.5rem;
        position: relative;
        overflow: hidden;
        margin-bottom: 2rem;
        box-shadow: 0 6px 30px rgba(0, 0, 0, 0.1);
        z-index: 10;
    }
    
    .page-header::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 150px;
        height: 150px;
        background-color: var(--accent);
        clip-path: polygon(100% 0, 0 0, 100% 100%);
        opacity: 0.2;
        z-index: -1;
    }
    
    .page-header::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 120px;
        height: 120px;
        background-color: var(--success);
        clip-path: polygon(0 100%, 0 0, 100% 100%);
        opacity: 0.2;
        z-index: -1;
    }
    
    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .company-title {
        color: var(--light);
        margin: 0;
        font-size: 2rem;
        font-weight: 700;
        position: relative;
    }
    
    .company-title::after {
        content: '';
        position: absolute;
        bottom: -8px;
        left: 0;
        width: 50px;
        height: 3px;
        background-color: var(--accent);
    }
    
    .breadcrumb {
        display: flex;
        list-style: none;
        margin: 0;
        padding: 0;
        background: transparent;
    }
    
    .breadcrumb-item {
        color: rgba(255, 255, 255, 0.7);
        font-weight: 500;
    }
    
    .breadcrumb-item + .breadcrumb-item::before {
        content: "/";
        color: rgba(255, 255, 255, 0.5);
        padding: 0 0.5rem;
    }
    
    .breadcrumb-item a {
        color: var(--accent);
        text-decoration: none;
        transition: color 0.2s ease;
    }
    
    .breadcrumb-item a:hover {
        color: white;
    }
    
    .breadcrumb-item.active {
        color: white;
    }
    
    /* ===== CARD STYLES ===== */
    .custom-card {
        background-color: white;
        border-radius: 0.5rem;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
        margin-bottom: 2rem;
        overflow: hidden;
    }
    
    .card-header {
        padding: 1.25rem 1.5rem;
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .card-header h5 {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--primary);
    }
    
    .card-body {
        padding: 1.5rem;
    }
    
    /* Special headers */
    .header-danger {
        background-color: var(--danger);
        color: white;
    }
    
    .header-success {
        background-color: var(--success);
        color: white;
    }
    
    .header-accent {
        background-color: var(--accent);
        color: var(--primary);
    }
    
    /* ===== COMPANY INFO CARD ===== */
    .info-item {
        display: flex;
        margin-bottom: 1rem;
        align-items: center;
    }
    
    .info-item:last-child {
        margin-bottom: 0;
    }
    
    .info-icon {
        width: 36px;
        height: 36px;
        background-color: #f8f9fa;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary);
        margin-right: 1rem;
    }
    
    .info-label {
        font-weight: 600;
        color: var(--secondary);
        margin-right: 0.5rem;
    }
    
    .info-value {
        color: var(--primary);
    }
    
    /* ===== TABLES ===== */
    .custom-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }
    
    .custom-table th {
        background-color: #f8f9fa;
        padding: 0.75rem 1rem;
        font-weight: 600;
        color: var(--secondary);
        border-bottom: 2px solid #e9ecef;
        text-align: left;
    }
    
    .custom-table td {
        padding: 1rem;
        border-bottom: 1px solid #e9ecef;
        vertical-align: middle;
    }
    
    .custom-table tr:last-child td {
        border-bottom: none;
    }
    
    .custom-table tr:hover {
        background-color: #f8f9fa;
    }
    
    .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    /* ===== BADGES ===== */
    .badge {
        display: inline-block;
        padding: 0.35em 0.65em;
        font-size: 0.75em;
        font-weight: 600;
        line-height: 1;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: 50rem;
    }
    
    .badge-success {
        background-color: var(--success);
        color: white;
    }
    
    .badge-danger {
        background-color: var(--danger);
        color: white;
    }
    
    .badge-warning {
        background-color: var(--warning);
        color: white;
    }
    
    .badge-secondary {
        background-color: var(--secondary);
        color: white;
    }
    
    /* ===== ARRANGEMENT CARDS ===== */
    .arrangements-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
    }
    
    .arrangement-card {
        background-color: white;
        border-radius: 0.5rem;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        height: 100%;
        border: 2px solid transparent;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .arrangement-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .arrangement-card.active {
        border-color: var(--success);
    }
    
    .arrangement-card.inactive {
        border-color: var(--secondary);
    }
    
    .arrangement-header {
        padding: 1rem 1.25rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .arrangement-header.active {
        background-color: var(--success);
        color: white;
    }
    
    .arrangement-header.inactive {
        background-color: var(--secondary);
        color: white;
    }
    
    .arrangement-header h6 {
        margin: 0;
        font-weight: 600;
    }
    
    .arrangement-body {
        padding: 1.25rem;
    }
    
    .arrangement-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.75rem;
    }
    
    .arrangement-item:last-child {
        margin-bottom: 0;
    }
    
    .arrangement-label {
        font-weight: 600;
        color: var(--secondary);
    }
    
    .arrangement-value {
        color: var(--primary);
    }
    
    /* ===== BUTTONS ===== */
    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        text-align: center;
        text-decoration: none;
        vertical-align: middle;
        cursor: pointer;
        user-select: none;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        border-radius: 0.5rem;
        border: none;
        transition: all 0.15s ease-in-out;
        gap: 0.5rem;
    }
    
    .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
    }
    
    .btn-primary {
        color: var(--primary);
        background-color: var(--accent);
    }
    
    .btn-primary:hover {
        background-color: #ffc840;
        box-shadow: 0 4px 10px rgba(255, 211, 105, 0.3);
    }
    
    .btn-success {
        color: white;
        background-color: var(--success);
    }
    
    .btn-success:hover {
        background-color: #00c2cc;
        box-shadow: 0 4px 10px rgba(0, 173, 181, 0.3);
    }
    
    .btn-secondary {
        color: white;
        background-color: var(--secondary);
    }
    
    .btn-secondary:hover {
        background-color: #424852;
        box-shadow: 0 4px 10px rgba(57, 62, 70, 0.3);
    }
    
    .btn-danger {
        color: white;
        background-color: var(--danger);
    }
    
    .btn-danger:hover {
        background-color: #ff7043;
        box-shadow: 0 4px 10px rgba(255, 87, 34, 0.3);
    }
    
    .btn-loading {
        pointer-events: none;
        opacity: 0.7;
    }
    
    /* ===== MODAL ===== */
    .custom-modal {
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1050;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        overflow: auto;
    }
    
    .custom-modal.show {
        display: block;
    }
    
    .modal-dialog {
        position: relative;
        width: auto;
        margin: 1.75rem auto;
        max-width: 500px;
    }
    
    .modal-content {
        background-color: white;
        border-radius: 0.5rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }
    
    .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #e9ecef;
    }
    
    .modal-title {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 600;
    }
    
    .btn-close {
        background: transparent;
        border: none;
        font-size: 1.5rem;
        line-height: 1;
        color: #000;
        opacity: 0.5;
        padding: 0;
        cursor: pointer;
    }
    
    .modal-body {
        padding: 1.5rem;
    }
    
    .modal-footer {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        padding: 1rem 1.5rem;
        border-top: 1px solid #e9ecef;
        gap: 0.5rem;
    }
    
    /* ===== ALERTS ===== */
    .alert {
        position: relative;
        padding: 1rem 1.25rem;
        margin-bottom: 1rem;
        border: 1px solid transparent;
        border-radius: 0.5rem;
    }
    
    .alert:last-child {
        margin-bottom: 0;
    }
    
    .alert-info {
        color: #0c5460;
        background-color: #d1ecf1;
        border-color: #bee5eb;
    }
    
    .alert-danger {
        color: #721c24;
        background-color: #f8d7da;
        border-color: #f5c6cb;
    }
    
    .alert-warning {
        color: #856404;
        background-color: #fff3cd;
        border-color: #ffeeba;
    }
    
    /* ===== RESPONSIVE STYLES ===== */
    @media (max-width: 767.98px) {
        .page-header {
            padding: 1.5rem;
        }
        
        .header-content {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .breadcrumb {
            margin-top: 1rem;
        }
        
        .card-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .arrangements-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Company Header -->
    <div class="page-header">
        <div class="header-content">
            <h1 class="company-title">{{ company.name }}</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'payments:company-list' %}">Kompaniyalar</a></li>
                    <li class="breadcrumb-item active">{{ company.name }}</li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Company Information -->
    <div class="custom-card">
        <div class="card-header">
            <h5>Kompaniya Ma'lumotlari</h5>
        </div>
        <div class="card-body">
            <div class="info-item">
                <div class="info-icon">
                    <i class="fas fa-envelope"></i>
                </div>
                <span class="info-label">Email:</span>
                <span class="info-value">{{ company.email }}</span>
            </div>
            <div class="info-item">
                <div class="info-icon">
                    <i class="fas fa-phone"></i>
                </div>
                <span class="info-label">Telefon Raqami:</span>
                <span class="info-value">{{ company.contact_number }}</span>
            </div>
            <div class="info-item">
                <div class="info-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <span class="info-label">Manzil:</span>
                <span class="info-value">{{ company.address }}</span>
            </div>
            <div class="info-item">
                <div class="info-icon">
                    <i class="fas fa-calendar"></i>
                </div>
                <span class="info-label">Ro'yxatga Olingan Sana:</span>
                <span class="info-value">{{ company.created_at|date:"F j, Y" }}</span>
            </div>
        </div>
    </div>

    <!-- Unpaid Months Section -->
    {% if unpaid_months %}
    <div class="custom-card">
        <div class="card-header header-danger">
            <h5>
                <i class="fas fa-exclamation-triangle me-2"></i>
                To'lanmagan/Qisman to'langan oylar
            </h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="custom-table">
                    <thead>
                        <tr>
                            <th>Shartnoma</th>
                            <th>Oy</th>
                            <th>To'lov Muddati</th>
                            <th>Kutilgan Summa</th>
                            <th>To'langan Summa</th>
                            <th>Yetishmayotgan Summa</th>
                            <th>Holat</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for month in unpaid_months %}
                            <tr>
                                <td>Shartnoma #{{ month.arrangement_id }}</td>
                                <td>{{ month.month_number }}-oy</td>
                                <td>{{ month.due_date|date:"M j, Y" }}</td>
                                <td>${{ month.expected_amount|floatformat:2 }}</td>
                                <td>${{ month.paid_amount|floatformat:2 }}</td>
                                <td class="text-danger">${{ month.missing_amount|floatformat:2 }}</td>
                                <td>
                                    {% if month.paid_amount == 0 %}
                                        <span class="badge badge-danger">To'lanmagan</span>
                                    {% else %}
                                        <span class="badge badge-warning">Qisman to'langan</span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Payment Arrangements Section -->
    <div class="custom-card">
        <div class="card-header">
            <h5>To'lov Shartnomalari</h5>
            <a href="{% url 'payments:add-arrangement' %}?company={{ company.id }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Yangi Shartnoma Qo'shish
            </a>
        </div>
        <div class="card-body">
            <div class="arrangements-grid">
                {% for arrangement in arrangements %}
                    <div class="arrangement-card {% if arrangement.is_active %}active{% else %}inactive{% endif %}">
                        <div class="arrangement-header {% if arrangement.is_active %}active{% else %}inactive{% endif %}">
                            <h6>Shartnoma #{{ arrangement.id }}</h6>
                            <button type="button"
                                    class="btn btn-sm btn-danger delete-arrangement-btn"
                                    data-modal-id="deleteArrangementModal{{ arrangement.id }}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                        <div class="arrangement-body">
                            <div class="arrangement-item">
                                <span class="arrangement-label">Oylik To'lov:</span>
                                <span class="arrangement-value">${{ arrangement.monthly_amount|floatformat:2 }}</span>
                            </div>
                            <div class="arrangement-item">
                                <span class="arrangement-label">Oylar Soni:</span>
                                <span class="arrangement-value">{{ arrangement.number_of_months }}</span>
                            </div>
                            <div class="arrangement-item">
                                <span class="arrangement-label">Jami Summa:</span>
                                <span class="arrangement-value">${{ arrangement.total_amount|floatformat:2 }}</span>
                            </div>
                            <div class="arrangement-item">
                                <span class="arrangement-label">Boshlanish Sanasi:</span>
                                <span class="arrangement-value">{{ arrangement.start_date|date:"M j, Y" }}</span>
                            </div>
                            <div class="arrangement-item">
                                <span class="arrangement-label">Tugash Sanasi:</span>
                                <span class="arrangement-value">{{ arrangement.end_date|date:"M j, Y"|default:"Davom etmoqda" }}</span>
                            </div>
                            <div class="arrangement-item">
                                <span class="arrangement-label">Holat:</span>
                                <span class="arrangement-value">
                                    <span class="badge {% if arrangement.is_active %}badge-success{% else %}badge-secondary{% endif %}">
                                        {% if arrangement.is_active %}Faol{% else %}Faol emas{% endif %}
                                    </span>
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Delete Modal for Arrangement -->
                    <div class="custom-modal" id="deleteArrangementModal{{ arrangement.id }}">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Shartnomani O'chirish</h5>
                                    <button type="button" class="btn-close close-modal" data-modal-id="deleteArrangementModal{{ arrangement.id }}">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <p>Haqiqatan ham ushbu to'lov shartnomasini o'chirishni xohlaysizmi?</p>
                                    <div class="alert alert-info">
                                        <p class="mb-2"><strong>Shartnoma tafsilotlari:</strong></p>
                                        <ul class="mb-0">
                                            <li>Oylik To'lov: ${{ arrangement.monthly_amount|floatformat:2 }}</li>
                                            <li>Oylar Soni: {{ arrangement.number_of_months }}</li>
                                            <li>Jami Summa: ${{ arrangement.total_amount|floatformat:2 }}</li>
                                        </ul>
                                    </div>
                                    <div class="alert alert-danger mb-0">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        Bu amalni ortga qaytarib bo'lmaydi.
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary close-modal" data-modal-id="deleteArrangementModal{{ arrangement.id }}">Bekor qilish</button>
                                    <form id="delete-arrangement-form-{{ arrangement.id }}" method="POST" action="{% url 'payments:delete-arrangement' arrangement.id %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="confirm" value="yes">
                                        <button type="submit" class="btn btn-danger submit-arrangement-btn" data-arrangement-id="{{ arrangement.id }}">
                                            <i class="fas fa-trash-alt"></i> O'chirish
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <div class="col-12">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Hali hech qanday to'lov shartnomasi yo'q.
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Payment History Section -->
    <div class="custom-card">
        <div class="card-header">
            <h5>To'lovlar Tarixi</h5>
            <a href="{% url 'payments:add-payment' %}?company={{ company.id }}" class="btn btn-success">
                <i class="fas fa-plus"></i> Yangi To'lovni Qayd Etish
            </a>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="custom-table">
                    <thead>
                        <tr>
                            <th>Sana</th>
                            <th>Shartnoma</th>
                            <th>Oy</th>
                            <th>Summa</th>
                            <th>To'lov Usuli</th>
                            <th>Holat</th>
                            <th>Izohlar</th>
                            <th>Harakatlar</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for payment in payments %}
                            <tr>
                                <td>{{ payment.payment_date|date:"M j, Y" }}</td>
                                <td>Shartnoma #{{ payment.arrangement.id }}</td>
                                <td>{{ payment.month_number }}-oy</td>
                                <td>${{ payment.amount_paid|floatformat:2 }}</td>
                                <td>{{ payment.payment_method }}</td>
                                <td>
                                    <span class="badge {% if payment.status == 'COMPLETED' %}badge-success
                                                      {% elif payment.status == 'PENDING' %}badge-warning
                                                      {% elif payment.status == 'PARTIAL' %}badge-warning
                                                      {% elif payment.status == 'UNPAID' %}badge-danger
                                                      {% else %}badge-danger{% endif %}">
                                        {% if payment.status == 'COMPLETED' %}To'langan
                                        {% elif payment.status == 'PENDING' %}Kutilmoqda
                                        {% elif payment.status == 'PARTIAL' %}Qisman to'langan
                                        {% elif payment.status == 'UNPAID' %}To'lanmagan
                                        {% else %}{{ payment.get_status_display }}{% endif %}
                                    </span>
                                </td>
                                <td>{{ payment.notes|truncatechars:30|default:"-" }}</td>
                                <td>
                                    <button type="button" 
                                            class="btn btn-sm btn-danger delete-payment-btn" 
                                            data-modal-id="deletePaymentModal{{ payment.id }}">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>

                            <!-- Delete Payment Modal -->
                            <div class="custom-modal" id="deletePaymentModal{{ payment.id }}">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">To'lovni O'chirish</h5>
                                            <button type="button" class="btn-close close-modal" data-modal-id="deletePaymentModal{{ payment.id }}">&times;</button>
                                        </div>
                                        <div class="modal-body">
                                            <p>Haqiqatan ham ushbu to'lovni o'chirishni xohlaysizmi?</p>
                                            <div class="alert alert-info">
                                                <p class="mb-2"><strong>To'lov tafsilotlari:</strong></p>
                                                <ul class="mb-0">
                                                    <li>Sana: {{ payment.payment_date|date:"M j, Y" }}</li>
                                                    <li>Summa: ${{ payment.amount_paid|floatformat:2 }}</li>
                                                    <li>Shartnoma: #{{ payment.arrangement.id }}</li>
                                                    <li>Oy: {{ payment.month_number }}</li>
                                                    {% if payment.notes %}
                                                        <li>Izohlar: {{ payment.notes }}</li>
                                                    {% endif %}
                                                </ul>
                                            </div>
                                            <div class="alert alert-danger mb-0">
                                                <i class="fas fa-exclamation-triangle me-2"></i>
                                                Bu amalni ortga qaytarib bo'lmaydi.
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary close-modal" data-modal-id="deletePaymentModal{{ payment.id }}">Bekor qilish</button>
                                            <form id="delete-payment-form-{{ payment.id }}" method="POST" action="{% url 'payments:delete-payment' payment.id %}">
                                                {% csrf_token %}
                                                <input type="hidden" name="confirm" value="yes">
                                                <button type="submit" class="btn btn-danger submit-payment-btn" data-payment-id="{{ payment.id }}">
                                                    <i class="fas fa-trash-alt"></i> O'chirish
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% empty %}
                            <tr>
                                <td colspan="8" class="text-center">Hali hech qanday to'lov qayd etilmagan.</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Modal Control and Debugging -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Page loaded, initializing modal controls');

    // Open modal for arrangements
    document.querySelectorAll('.delete-arrangement-btn').forEach(button => {
        button.addEventListener('click', function() {
            const modalId = this.getAttribute('data-modal-id');
            console.log('Attempting to open arrangement modal:', modalId);
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
                console.log('Arrangement modal opened successfully:', modalId);
            } else {
                console.error('Arrangement modal not found:', modalId);
            }
        });
    });

    // Open modal for payments
    document.querySelectorAll('.delete-payment-btn').forEach(button => {
        button.addEventListener('click', function() {
            const modalId = this.getAttribute('data-modal-id');
            console.log('Attempting to open payment modal:', modalId);
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
                console.log('Payment modal opened successfully:', modalId);
            } else {
                console.error('Payment modal not found:', modalId);
            }
        });
    });

    // Close modal
    document.querySelectorAll('.close-modal').forEach(button => {
        button.addEventListener('click', function() {
            const modalId = this.getAttribute('data-modal-id');
            console.log('Closing modal:', modalId);
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = '';
                console.log('Modal closed successfully:', modalId);
            } else {
                console.error('Modal not found for closing:', modalId);
            }
        });
    });

    // Handle arrangement form submission
    document.querySelectorAll('.submit-arrangement-btn').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault(); // Prevent default to debug
            const arrangementId = this.getAttribute('data-arrangement-id');
            const form = document.getElementById('delete-arrangement-form-' + arrangementId);
            if (form) {
                console.log('Submitting arrangement form for ID:', arrangementId);
                console.log('Form action:', form.action);
                console.log('Form data:', Object.fromEntries(new FormData(form)));
                this.classList.add('btn-loading');
                this.disabled = true;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Yuklanmoqda...';
                // Submit the form manually after logging
                setTimeout(() => {
                    console.log('Manually submitting arrangement form:', arrangementId);
                    form.submit();
                }, 500);
            } else {
                console.error('Arrangement form not found for ID:', arrangementId);
            }
        });
    });

    // Handle payment form submission
    document.querySelectorAll('.submit-payment-btn').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault(); // Prevent default to debug
            const paymentId = this.getAttribute('data-payment-id');
            const form = document.getElementById('delete-payment-form-' + paymentId);
            if (form) {
                console.log('Submitting payment form for ID:', paymentId);
                console.log('Form action:', form.action);
                console.log('Form data:', Object.fromEntries(new FormData(form)));
                this.classList.add('btn-loading');
                this.disabled = true;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Yuklanmoqda...';
                // Submit the form manually after logging
                setTimeout(() => {
                    console.log('Manually submitting payment form:', paymentId);
                    form.submit();
                }, 500);
            } else {
                console.error('Payment form not found for ID:', paymentId);
            }
        });
    });

    // Close modal on backdrop click
    document.querySelectorAll('.custom-modal').forEach(modal => {
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                console.log('Backdrop clicked, closing modal:', modal.id);
                modal.classList.remove('show');
                document.body.style.overflow = '';
            }
        });
    });
});
</script>
{% endblock %}