
{% extends 'payments/base4.html' %}
{% load humanize %}

{% block title %}Companies - Payment System{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
    body {
        background-color: #f8f9fa;
    }

    .page-header {
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-bottom: 1px solid #dee2e6;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    /* Search styles */
    .search-wrapper {
        position: relative;
        max-width: 300px;
    }

    .search-input {
        width: 100%;
        padding: 0.5rem 2rem 0.5rem 0.75rem;
        font-size: 0.95rem;
        border: none;
        border-bottom: 1px solid #dee2e6;
        background-color: transparent;
        transition: border-color 0.2s ease;
    }

    .search-input:focus {
        outline: none;
        border-bottom-color: #007bff;
    }

    .search-input::placeholder {
        color: #adb5bd;
        font-size: 0.9rem;
    }

    .search-icon {
        position: absolute;
        right: 0.5rem;
        top: 50%;
        transform: translateY(-50%);
        color: #adb5bd;
        font-size: 0.9rem;
    }

    /* Horizontal scroll container */
    .companies-scroll-container {
        width: 100%;
        overflow-x: auto;
        padding: 1rem 0;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        scrollbar-color: #007bff #f8f9fa;
    }

    .companies-scroll-container::-webkit-scrollbar {
        height: 6px;
    }

    .companies-scroll-container::-webkit-scrollbar-track {
        background: #f8f9fa;
        border-radius: 3px;
    }

    .companies-scroll-container::-webkit-scrollbar-thumb {
        background-color: #007bff;
        border-radius: 3px;
    }

    /* Horizontal row of cards */
    .companies-row {
        display: inline-flex;
        gap: 1.5rem;
        padding: 0.5rem;
        min-width: min-content;
    }

    .company-item {
        width: 400px;
        flex-shrink: 0;
    }

    .company-card {
        background-color: #fff;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        height: 100%;
    }

    .company-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .card-header {
        background-color: #f0f0f5;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #e9ecef;
    }

    .card-body {
        padding: 1.5rem;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 1rem;
    }

    .stat-item {
        text-align: left;
    }

    .stat-item i {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: #6c757d;
    }

    .stat-item h6 {
        color: #495057;
        margin-bottom: 0.25rem;
        font-weight: 500;
        font-size: 0.9rem;
    }

    .stat-item .value {
        font-weight: 600;
        font-size: 1.1rem;
        color: #343a40;
    }

    .company-info {
        padding: 1rem 1.5rem;
        border-top: 1px solid #e9ecef;
        background-color: #fff;
        font-size: 0.85rem;
    }

    .info-item {
        margin-bottom: 0.25rem;
    }

    .info-item strong {
        font-weight: 500;
        margin-right: 0.25rem;
        color: #495057;
    }

    .card-actions {
        display: flex;
        justify-content: space-between;
        padding: 1rem 1.5rem;
        border-top: 1px solid #e9ecef;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .card-actions .btn {
        margin: 0;
        font-size: 0.9rem;
        padding: 0.375rem 0.75rem;
    }

    .due {
        color: red;
        font-weight: bold;
    }

    .not-due {
        color: green;
        font-weight: bold;
    }

    .partial {
        color: orange;
        font-weight: bold;
    }

    #noResults, #noCompanies {
        padding: 2rem;
        text-align: center;
        font-size: 1.1rem;
        color: #6c757d;
        background-color: white;
        border-radius: 8px;
        margin: 1rem 0;
        width: 100%;
    }
</style>
{% endblock %}

{% block content %}
    <div class="page-header">
        <h1>Companies</h1>
        <div class="search-wrapper">
            <input 
                type="text" 
                id="companySearch" 
                class="search-input" 
                placeholder="Search companies..."
                aria-label="Search companies"
            >
            <i class="fas fa-search search-icon"></i>
        </div>
    </div>
    

    <div class="companies-scroll-container">
        <div class="companies-row" id="companiesContainer">
            {% if companies %}
                {% for company_info in companies %}
                    <div class="company-item" data-company-name="{{ company_info.company.name|lower }}">
                        <div class="company-card">
                            <div class="card-header">
                                <h3>{{ company_info.company.name }}</h3>
                            </div>
                            <div class="card-body">
                                <div class="stat-item">
                                    <i class="fas fa-hand-holding-usd"></i>
                                    <h6>Total Agreement</h6>
                                    <div class="value">${{ company_info.total_to_pay|intcomma }}</div>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <h6>Total Paid</h6>
                                    <div class="value">${{ company_info.total_paid|intcomma }}</div>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <h6>Current Due</h6>
                                    <div class="value {% if company_info.current_due > 0 %}due{% else %}not-due{% endif %}">
                                        ${{ company_info.current_due|intcomma }}
                                    </div>
                                </div>
                            </div>
                            <div class="company-info">
                                {% if company_info.company.address %}
                                    <div class="info-item"><strong>Address:</strong> {{ company_info.company.address }}</div>
                                {% endif %}
                                {% if company_info.company.phone_number %}
                                    <div class="info-item"><strong>Phone:</strong> {{ company_info.company.phone_number }}</div>
                                {% endif %}
                                {% if company_info.company.email %}
                                    <div class="info-item"><strong>Email:</strong> {{ company_info.company.email }}</div>
                                {% endif %}
                            </div>
                            <div class="card-actions">
                                <a href="{% url 'payments:company-detail' company_info.company.pk %}" class="btn btn-primary">View Details</a>
                                <a href="{% url 'payments:company-monthly-payments' company_info.company.pk %}" class="btn btn-info">View Monthly Payments</a>
                                <a href="{% url 'payments:delete-company' company_info.company.pk %}" class="btn btn-danger">
                                    <i class="fas fa-trash"></i> Delete
                                </a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p id="noResults" class="d-none">No companies found matching your search.</p>
                <p id="noCompanies">No companies found.</p>
            {% endif %}
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('companySearch');
            const companies = document.getElementsByClassName('company-item');
            const noResults = document.getElementById('noResults');
            const noCompanies = document.getElementById('noCompanies');

            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase().trim();
                let visibleCount = 0;

                Array.from(companies).forEach(company => {
                    const companyName = company.dataset.companyName;
                    if (companyName.includes(searchTerm)) {
                        company.style.display = '';
                        visibleCount++;
                    } else {
                        company.style.display = 'none';
                    }
                });

                if (companies.length > 0) {
                    noResults.classList.toggle('d-none', visibleCount > 0);
                    noCompanies.classList.add('d-none');
                }
            });
        });
    </script>
{% endblock %}